# Тестовый сценарий: Проверка готовности анализа Луны

## Проблема (БЫЛО):
```
1. Пользователь заполняет анкету
2. Создается запись в predictions с content (сырые данные)
3. check_existing_moon_prediction() возвращает True (есть запись)
4. Показывается главное меню ДО того, как воркер обработал данные
5. Пользователь видит меню, но анализа еще нет!
```

## Решение (СТАЛО):
```
1. Пользователь заполняет анкету
2. Создается запись в predictions с content (сырые данные), moon_analysis = NULL
3. check_existing_moon_prediction() возвращает False (нет готового анализа)
4. Показывается анкета или сообщение "анализ готовится"
5. Воркер обрабатывает данные → заполняет moon_analysis
6. При следующем /start показывается главное меню
```

## Тестовые случаи:

### Случай 1: Новый пользователь
```
1. /start
2. has_moon_analysis = False (нет записей)
3. Показывается анкета ✅
```

### Случай 2: Пользователь с незавершенным анализом
```
1. Пользователь заполнил анкету
2. Создана запись: content = "сырые данные", moon_analysis = NULL
3. /start
4. has_moon_analysis = False (moon_analysis пустой)
5. Показывается сообщение "анализ готовится" ✅
```

### Случай 3: Пользователь с готовым анализом
```
1. Воркер обработал данные
2. Запись: content = "сырые данные", moon_analysis = "готовый анализ"
3. /start
4. has_moon_analysis = True (moon_analysis заполнен)
5. Показывается главное меню ✅
```

## Проверка в коде:

```python
# В check_existing_moon_prediction():
Prediction.moon_analysis.is_not(None)  # ← КЛЮЧЕВОЕ ИЗМЕНЕНИЕ
```

Теперь функция проверяет не просто наличие записи, а наличие **готового анализа**!
