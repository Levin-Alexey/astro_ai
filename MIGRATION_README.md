# Миграция базы данных: Разделение данных по столбцам

## Описание изменений

Обновлена структура таблицы `predictions` для разделения данных по типам контента. Теперь вместо одного столбца `content` используются отдельные столбцы для каждого типа данных.

## Новые столбцы

- `moon_analysis` - Анализ Луны (бесплатный)
- `sun_analysis` - Анализ Солнца (платный)
- `mercury_analysis` - Анализ Меркурия (платный)
- `venus_analysis` - Анализ Венеры (платный)
- `mars_analysis` - Анализ Марса (платный)
- `recommendations` - Рекомендации по темам
- `qa_responses` - Ответы на вопросы пользователя

## Применение миграции

1. **Остановите бота** (если он запущен)

2. **Примените миграцию SQL:**
   ```bash
   psql -d your_database_name -f migration_add_prediction_columns.sql
   ```

3. **Проверьте, что миграция применилась:**
   ```sql
   \d predictions
   ```

4. **Запустите бота** - он будет использовать новую структуру

## Преимущества новой структуры

- ✅ **Нет перезаписи данных** - каждый тип контента хранится отдельно
- ✅ **Лучшая организация** - легко найти нужный тип данных
- ✅ **Совместимость** - старый столбец `content` сохранен
- ✅ **Масштабируемость** - легко добавлять новые типы контента

## Обратная совместимость

- Старый столбец `content` остается для совместимости
- Существующие данные не затрагиваются
- Новый код автоматически использует соответствующие столбцы

## Проверка работы

После применения миграции проверьте:

1. Бот запускается без ошибок
2. Новые пользователи могут создавать разборы
3. Данные сохраняются в правильные столбцы
4. Существующие данные остаются доступными

## Откат (если нужен)

Если нужно откатить изменения:

```sql
-- Удалить новые столбцы
ALTER TABLE predictions 
DROP COLUMN moon_analysis,
DROP COLUMN sun_analysis,
DROP COLUMN mercury_analysis,
DROP COLUMN venus_analysis,
DROP COLUMN mars_analysis,
DROP COLUMN recommendations,
DROP COLUMN qa_responses;

-- Вернуть content как NOT NULL
ALTER TABLE predictions 
ALTER COLUMN content SET NOT NULL;

-- Удалить ограничение
ALTER TABLE predictions 
DROP CONSTRAINT at_least_one_content_type;
```
